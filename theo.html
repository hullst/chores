<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Theo Chores">
<title>Theo's Chores</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

  body {
    background: #000;
    color: #fff;
    font-family: -apple-system, sans-serif;
    min-height: 100vh;
    font-size: 16px;
  }

  #loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    gap: 12px;
    color: #888;
    font-size: 14px;
  }

  .spinner {
    width: 28px; height: 28px;
    border: 3px solid #333;
    border-top-color: #7B5CF5;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  #app { display: none; }

  .header {
    background: #111;
    padding: 10px 12px 8px;
    position: sticky;
    top: 0;
    z-index: 9;
    border-bottom: 1px solid #222;
  }

  .header h1 { font-size: 17px; font-weight: 700; }
  .header h1 em { font-style: normal; color: #7B5CF5; }

  .prog-row { display: flex; align-items: center; gap: 8px; margin-top: 6px; }
  .prog-track { flex: 1; height: 5px; background: #333; border-radius: 3px; overflow: hidden; }
  .prog-fill { height: 100%; background: #30D158; border-radius: 3px; transition: width 0.3s; }
  .prog-txt { font-size: 11px; font-weight: 700; color: #888; white-space: nowrap; }

  .days {
    display: flex;
    overflow-x: auto;
    gap: 6px;
    padding: 8px 12px;
    scrollbar-width: none;
  }
  .days::-webkit-scrollbar { display: none; }

  .day {
    flex-shrink: 0;
    padding: 5px 12px;
    border-radius: 20px;
    border: none;
    background: #222;
    color: #888;
    font-size: 12px;
    font-weight: 700;
    cursor: pointer;
    font-family: -apple-system, sans-serif;
  }

  .day.on { background: #7B5CF5; color: #fff; }

  .sec-head {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #666;
    padding: 12px 12px 4px;
  }

  .row {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 12px;
    background: #1a1a1a;
    border-bottom: 1px solid #222;
    cursor: pointer;
    min-height: 54px;
  }

  .row:active { background: #252525; }
  .row.done { opacity: 0.4; }

  .ico { font-size: 20px; flex-shrink: 0; }

  .mid { flex: 1; }
  .lbl { font-size: 15px; font-weight: 600; }
  .row.done .lbl { text-decoration: line-through; color: #666; }
  .tm { font-size: 10px; color: #666; margin-top: 1px; }

  .chk {
    width: 28px; height: 28px;
    border-radius: 50%;
    border: 2px solid #444;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
    font-size: 14px;
    font-weight: 700;
  }

  .row.done .chk { background: #30D158; border-color: #30D158; color: #000; }

  .done-msg {
    display: none;
    flex-direction: column;
    align-items: center;
    padding: 28px 20px;
    text-align: center;
    gap: 6px;
  }

  .done-msg.show { display: flex; }
  .done-msg .big { font-size: 48px; }
  .done-msg h2 { font-size: 20px; font-weight: 700; }
  .done-msg p { font-size: 13px; color: #888; }

  .sync {
    position: fixed;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
    background: #1a1a1a;
    border: 1px solid #333;
    color: #888;
    font-size: 10px;
    font-weight: 700;
    padding: 5px 12px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    gap: 5px;
    z-index: 20;
  }

  .sync.syncing { color: #f7971e; }
  .sync.synced { color: #30D158; }
  .sync.error { color: #ff453a; }

  .dot { width: 5px; height: 5px; border-radius: 50%; background: currentColor; }
  .dot.spin { animation: pulse 0.8s ease-in-out infinite; }

  @keyframes pulse {
    0%,100% { opacity:1; } 50% { opacity:0.2; }
  }

  /* Extra small screens (Watch) */
  @media (max-width: 200px) {
    body { font-size: 12px; }
    .header h1 { font-size: 13px; }
    .lbl { font-size: 12px; }
    .ico { font-size: 15px; }
    .chk { width: 22px; height: 22px; font-size: 11px; }
    .row { padding: 9px 8px; min-height: 42px; gap: 8px; }
    .day { font-size: 10px; padding: 4px 8px; }
    .sec-head { font-size: 8px; }
    .sync { font-size: 9px; }
  }
</style>
</head>
<body>

<div id="loading">
  <div class="spinner"></div>
  <span>Loading...</span>
</div>

<div id="app">
  <div class="header">
    <h1>‚≠ê <em>Theo's</em> Chores</h1>
    <div class="prog-row">
      <div class="prog-track"><div class="prog-fill" id="pFill" style="width:0%"></div></div>
      <div class="prog-txt" id="pTxt">0/0</div>
    </div>
  </div>

  <div class="days" id="days"></div>

  <div class="done-msg" id="doneMsg">
    <div class="big">üéâ</div>
    <h2>All done, Theo!</h2>
    <p>Amazing morning!</p>
  </div>

  <div id="list"></div>
</div>

<div class="sync synced" id="sync">
  <div class="dot" id="dot"></div>
  <span id="synctxt">Synced</span>
</div>

<!-- Firebase compat SDKs ‚Äî classic script tags, no ES modules -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// ---- Firebase init ----
firebase.initializeApp({
  apiKey: "AIzaSyBImvAIHP_3S9aDl0_yjhwtGG5pf1e5Z7k",
  authDomain: "hull-chores.firebaseapp.com",
  projectId: "hull-chores"
});
var db = firebase.firestore();

// ---- Data ----
var DAYS = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'];
var KID = 'theodore';

var CHORES = [
  { s: 'üåÖ Morning', label: 'Make bed', icon: 'üõèÔ∏è' },
  { s: 'üåÖ Morning', label: 'Brush teeth', icon: 'ü™•' },
  { s: 'üåÖ Morning', label: 'Get dressed', icon: 'üëï' },
  { s: 'üåÖ Morning', label: 'Eat breakfast', icon: 'ü•£' },
  { s: 'üåÖ Morning', label: 'Bring plates to sink', icon: 'ü´ß' },
  { s: 'üåÖ Morning', label: 'Put shoes & coat on', icon: 'üëü', noSat: true },
  { s: 'üè† Family',  label: 'Unload dishwasher', icon: 'üçΩÔ∏è' },
  { s: 'üè† Family',  label: 'Wipe bathroom sink (master)', icon: 'üöø' },
  { s: 'üè† Family',  label: 'Help fold laundry', icon: 'üëï' },
  { s: '‚ù§Ô∏è Special', label: 'Go kiss Momma good morning!', icon: 'üíã' },
];

function getChores(day) {
  return CHORES.filter(function(c) { return !(c.noSat && day === 'Saturday'); });
}

// ---- State ----
var today = new Date().getDay();
var currentDay = DAYS[today === 0 ? 6 : today - 1];
var state = {};
var unsub = null;

// ---- Firestore ----
function docRef(day) { return db.collection('chores').doc(day); }

function subscribe(day) {
  if (unsub) unsub();
  setSyncing('syncing');
  unsub = docRef(day).onSnapshot(function(snap) {
    state = snap.exists ? (snap.data().state || {}) : {};
    setSyncing('synced');
    render();
  }, function() { setSyncing('error'); });
}

function save() {
  setSyncing('syncing');
  docRef(currentDay).set({ state: state, updatedAt: Date.now() })
    .then(function() { setSyncing('synced'); })
    .catch(function() { setSyncing('error'); });
}

function setSyncing(s) {
  var el = document.getElementById('sync');
  var dot = document.getElementById('dot');
  var txt = document.getElementById('synctxt');
  el.className = 'sync ' + s;
  dot.className = 'dot' + (s === 'syncing' ? ' spin' : '');
  txt.textContent = s === 'syncing' ? 'Syncing...' : s === 'synced' ? 'Synced' : 'Error';
}

// ---- Toggle ----
function toggle(label) {
  if (!state[KID]) state[KID] = {};
  var was = state[KID][label] && state[KID][label].done;
  state[KID][label] = { done: !was, ts: Date.now() };
  render();
  save();
}

// ---- Render ----
function render() {
  var chores = getChores(currentDay);
  var kidState = state[KID] || {};
  var done = 0;
  for (var i = 0; i < chores.length; i++) {
    if (kidState[chores[i].label] && kidState[chores[i].label].done) done++;
  }
  var pct = chores.length ? Math.round(done / chores.length * 100) : 0;
  var allDone = done === chores.length && chores.length > 0;

  document.getElementById('pFill').style.width = pct + '%';
  document.getElementById('pTxt').textContent = done + '/' + chores.length;
  document.getElementById('doneMsg').className = 'done-msg' + (allDone ? ' show' : '');

  // Day tabs
  var daysHtml = '';
  for (var d = 0; d < DAYS.length; d++) {
    daysHtml += '<button class="day' + (DAYS[d] === currentDay ? ' on' : '') +
      '" onclick="selectDay(\'' + DAYS[d] + '\')">' + DAYS[d].slice(0,3) + '</button>';
  }
  document.getElementById('days').innerHTML = daysHtml;

  // Group by section
  var sections = {};
  var sectionOrder = [];
  for (var j = 0; j < chores.length; j++) {
    var c = chores[j];
    if (!sections[c.s]) { sections[c.s] = []; sectionOrder.push(c.s); }
    sections[c.s].push(c);
  }

  var html = '';
  for (var si = 0; si < sectionOrder.length; si++) {
    var sec = sectionOrder[si];
    html += '<div class="sec-head">' + sec + '</div>';
    var items = sections[sec];
    for (var k = 0; k < items.length; k++) {
      var ch = items[k];
      var isDone = kidState[ch.label] && kidState[ch.label].done;
      var ts = kidState[ch.label] && kidState[ch.label].ts;
      var timeStr = ts ? new Date(ts).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : '';
      var safeLabel = ch.label.replace(/'/g, "\\'");
      html += '<div class="row' + (isDone ? ' done' : '') + '" onclick="toggle(\'' + safeLabel + '\')">' +
        '<span class="ico">' + ch.icon + '</span>' +
        '<div class="mid">' +
          '<div class="lbl">' + ch.label + '</div>' +
          (isDone && timeStr ? '<div class="tm">Done at ' + timeStr + '</div>' : '') +
        '</div>' +
        '<div class="chk">' + (isDone ? '‚úì' : '') + '</div>' +
      '</div>';
    }
  }
  document.getElementById('list').innerHTML = html;
}

function selectDay(day) {
  currentDay = day;
  subscribe(day);
}

// ---- Boot ----
document.getElementById('loading').style.display = 'none';
document.getElementById('app').style.display = 'block';
subscribe(currentDay);
</script>
</body>
</html>
