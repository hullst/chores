<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Theo Chores">
<title>Theo's Chores</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

  body {
    background: #000;
    color: #fff;
    font-family: -apple-system, sans-serif;
    min-height: 100vh;
  }

  #loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    gap: 12px;
    color: #888;
    font-size: 14px;
  }

  .spinner {
    width: 28px; height: 28px;
    border: 3px solid #333;
    border-top-color: #7B5CF5;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  #app { display: none; padding-bottom: 48px; }

  .header {
    background: #111;
    padding: 10px 12px 8px;
    position: sticky;
    top: 0;
    z-index: 9;
    border-bottom: 1px solid #222;
  }

  .header h1 { font-size: 17px; font-weight: 700; }
  .header h1 em { font-style: normal; color: #7B5CF5; }

  .prog-row { display: flex; align-items: center; gap: 8px; margin-top: 6px; }
  .prog-track { flex: 1; height: 5px; background: #333; border-radius: 3px; overflow: hidden; }
  .prog-fill { height: 100%; background: #30D158; border-radius: 3px; transition: width 0.3s; }
  .prog-txt { font-size: 11px; font-weight: 700; color: #888; white-space: nowrap; }

  /* TOD tabs */
  .tod-strip {
    display: flex;
    gap: 6px;
    padding: 8px 10px;
    background: #0a0a0a;
    border-bottom: 1px solid #1a1a1a;
  }

  .tod-btn {
    flex: 1;
    padding: 7px 4px;
    border-radius: 12px;
    border: none;
    background: #222;
    color: #666;
    font-size: 11px;
    font-weight: 700;
    cursor: pointer;
    font-family: -apple-system, sans-serif;
    text-align: center;
    transition: all 0.15s;
  }

  .tod-btn.morning.on  { background: #f7971e; color: #000; }
  .tod-btn.afternoon.on { background: #30D158; color: #000; }
  .tod-btn.evening.on  { background: #7B5CF5; color: #fff; }

  .sec-head {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #555;
    padding: 10px 12px 3px;
  }

  .row {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 12px;
    background: #1a1a1a;
    border-bottom: 1px solid #222;
    cursor: pointer;
    min-height: 52px;
  }

  .row:active { background: #252525; }
  .row.done { opacity: 0.4; }

  .ico { font-size: 20px; flex-shrink: 0; }
  .mid { flex: 1; }
  .lbl { font-size: 15px; font-weight: 600; }
  .row.done .lbl { text-decoration: line-through; color: #555; }
  .tm { font-size: 10px; color: #555; margin-top: 1px; }

  .chk {
    width: 28px; height: 28px;
    border-radius: 50%;
    border: 2px solid #444;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
    font-size: 14px;
    font-weight: 700;
    color: #000;
  }

  .row.done .chk { background: #30D158; border-color: #30D158; }

  .done-msg {
    display: none;
    flex-direction: column;
    align-items: center;
    padding: 28px 20px;
    text-align: center;
    gap: 6px;
  }

  .done-msg.show { display: flex; }
  .done-msg .big { font-size: 48px; }
  .done-msg h2 { font-size: 20px; font-weight: 700; }
  .done-msg p { font-size: 13px; color: #888; }

  .sync {
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: #1a1a1a;
    border: 1px solid #333;
    color: #888;
    font-size: 10px;
    font-weight: 700;
    padding: 5px 12px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    gap: 5px;
    z-index: 20;
  }

  .sync.syncing { color: #f7971e; }
  .sync.synced  { color: #30D158; }
  .sync.error   { color: #ff453a; }

  .dot { width: 5px; height: 5px; border-radius: 50%; background: currentColor; }
  .dot.spin { animation: pulse 0.8s ease-in-out infinite; }

  @keyframes pulse {
    0%,100% { opacity:1; } 50% { opacity:0.2; }
  }

  @media (max-width: 200px) {
    .lbl { font-size: 12px; }
    .ico { font-size: 15px; }
    .chk { width: 22px; height: 22px; font-size: 11px; }
    .row { padding: 8px; min-height: 40px; gap: 8px; }
    .tod-btn { font-size: 9px; }
    .header h1 { font-size: 13px; }
  }
</style>
</head>
<body>

<div id="loading">
  <div class="spinner"></div>
  <span>Loading...</span>
</div>

<div id="app">
  <div class="header">
    <h1>‚≠ê <em>Theo's</em> Chores</h1>
    <div class="prog-row">
      <div class="prog-track"><div class="prog-fill" id="pFill" style="width:0%"></div></div>
      <div class="prog-txt" id="pTxt">0/0</div>
    </div>
  </div>

  <div class="tod-strip" id="todStrip"></div>

  <div class="done-msg" id="doneMsg">
    <div class="big">üéâ</div>
    <h2>All done, Theo!</h2>
    <p>Crushing it!</p>
  </div>

  <div id="list"></div>
</div>

<div class="sync synced" id="sync">
  <div class="dot" id="dot"></div>
  <span id="synctxt">Synced</span>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
firebase.initializeApp({
  apiKey: "AIzaSyBImvAIHP_3S9aDl0_yjhwtGG5pf1e5Z7k",
  authDomain: "hull-chores.firebaseapp.com",
  projectId: "hull-chores"
});
var db = firebase.firestore();

var KID = 'theodore';
var TOD_LIST = ['morning', 'afternoon', 'evening'];
var TOD_LABELS = { morning: 'üåÖ AM', afternoon: '‚òÄÔ∏è PM', evening: 'üåÜ EVE' };

var CHORES = {
  morning: [
    { s: 'Everyone',      label: 'Make bed',                   icon: 'üõèÔ∏è' },
    { s: 'Everyone',      label: 'Brush teeth',                icon: 'ü™•' },
    { s: 'Everyone',      label: 'Get dressed',                icon: 'üëï' },
    { s: 'Everyone',      label: 'Eat breakfast',              icon: 'ü•£' },
    { s: 'Everyone',      label: 'Bring plates to sink',       icon: 'ü´ß' },
    { s: 'Family Chores', label: 'Unload dishwasher',          icon: 'üçΩÔ∏è' },
    { s: 'Family Chores', label: 'Wipe bathroom sink',         icon: 'üöø' },
    { s: 'Family Chores', label: 'Help fold laundry',          icon: 'üëï' },
    { s: '‚ù§Ô∏è Special',    label: 'Go kiss Momma good morning!',icon: 'üíã' },
  ],
  afternoon: [
    { s: 'Everyone',  label: 'Eat lunch',             icon: 'ü•™' },
    { s: 'Everyone',  label: 'Bring lunch plates to sink', icon: 'ü´ß' },
    { s: 'Clean Up',  label: 'Clean pool bathroom',   icon: 'üöø' },
  ],
  evening: [
    { s: 'Everyone', label: 'Eat dinner',             icon: 'üçΩÔ∏è' },
    { s: 'Everyone', label: 'Bring dinner plates to sink', icon: 'ü´ß' },
    { s: 'Everyone', label: 'Eat dessert',            icon: 'üç®' },
  ]
};

var currentTod = 'morning';
var state = {};
var unsub = null;

function docRef() { return db.collection('chores').doc('saturday'); }

function subscribe() {
  if (unsub) unsub();
  setSyncing('syncing');
  unsub = docRef().onSnapshot(function(snap) {
    state = snap.exists ? (snap.data().state || {}) : {};
    setSyncing('synced');
    render();
  }, function() { setSyncing('error'); });
}

function save() {
  setSyncing('syncing');
  docRef().set({ state: state, updatedAt: Date.now() })
    .then(function() { setSyncing('synced'); })
    .catch(function() { setSyncing('error'); });
}

function setSyncing(s) {
  var el = document.getElementById('sync');
  var dot = document.getElementById('dot');
  var txt = document.getElementById('synctxt');
  el.className = 'sync ' + s;
  dot.className = 'dot' + (s === 'syncing' ? ' spin' : '');
  txt.textContent = s === 'syncing' ? 'Syncing...' : s === 'synced' ? 'Synced' : 'Error';
}

function choreKey(tod, label) { return tod + '__' + KID + '__' + label; }

function toggle(tod, label) {
  var k = choreKey(tod, label);
  if (!state[KID]) state[KID] = {};
  var was = state[KID][k] && state[KID][k].done;
  state[KID][k] = { done: !was, ts: Date.now() };
  render();
  save();
}

function selectTod(tod) {
  currentTod = tod;
  render();
}

function render() {
  var tod = currentTod;
  var chores = CHORES[tod];
  var kidState = state[KID] || {};

  // Progress across ALL sections today
  var allDone = 0, allTotal = 0;
  for (var t = 0; t < TOD_LIST.length; t++) {
    var tc = CHORES[TOD_LIST[t]];
    for (var i = 0; i < tc.length; i++) {
      var tk = choreKey(TOD_LIST[t], tc[i].label);
      allTotal++;
      if (kidState[tk] && kidState[tk].done) allDone++;
    }
  }
  document.getElementById('pFill').style.width = (allTotal ? Math.round(allDone/allTotal*100) : 0) + '%';
  document.getElementById('pTxt').textContent = allDone + '/' + allTotal;

  // TOD strip
  var todHtml = '';
  for (var ti = 0; ti < TOD_LIST.length; ti++) {
    var t2 = TOD_LIST[ti];
    todHtml += '<button class="tod-btn ' + t2 + (t2 === tod ? ' on' : '') +
      '" onclick="selectTod(\'' + t2 + '\')">' + TOD_LABELS[t2] + '</button>';
  }
  document.getElementById('todStrip').innerHTML = todHtml;

  // Current section chores
  var doneCt = 0;
  for (var ci = 0; ci < chores.length; ci++) {
    var ck = choreKey(tod, chores[ci].label);
    if (kidState[ck] && kidState[ck].done) doneCt++;
  }
  var secAllDone = doneCt === chores.length && chores.length > 0;
  document.getElementById('doneMsg').className = 'done-msg' + (secAllDone ? ' show' : '');

  // Group by section
  var sections = {}, sectionOrder = [];
  for (var sj = 0; sj < chores.length; sj++) {
    var sec = chores[sj].s;
    if (!sections[sec]) { sections[sec] = []; sectionOrder.push(sec); }
    sections[sec].push(chores[sj]);
  }

  var html = '';
  for (var si = 0; si < sectionOrder.length; si++) {
    var sn = sectionOrder[si];
    html += '<div class="sec-head">' + sn + '</div>';
    var items = sections[sn];
    for (var ii = 0; ii < items.length; ii++) {
      var ch = items[ii];
      var k = choreKey(tod, ch.label);
      var isDone = kidState[k] && kidState[k].done;
      var ts = kidState[k] && kidState[k].ts;
      var timeStr = ts ? new Date(ts).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) : '';
      var safe = ch.label.replace(/'/g,"\\'");
      html += '<div class="row' + (isDone ? ' done' : '') + '" onclick="toggle(\'' + tod + '\',\'' + safe + '\')">' +
        '<span class="ico">' + ch.icon + '</span>' +
        '<div class="mid"><div class="lbl">' + ch.label + '</div>' +
        (isDone && timeStr ? '<div class="tm">Done at ' + timeStr + '</div>' : '') +
        '</div><div class="chk">' + (isDone ? '‚úì' : '') + '</div></div>';
    }
  }
  document.getElementById('list').innerHTML = html;
}

// Boot
document.getElementById('loading').style.display = 'none';
document.getElementById('app').style.display = 'block';
subscribe();
</script>
</body>
</html>
