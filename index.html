<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Hull Chores">
<title>Hull Family Chore Board</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root { --bg: #FFF9F0; --card-bg: #fff; --shadow: 0 4px 20px rgba(0,0,0,0.08); --radius: 20px; }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Nunito', sans-serif; background: var(--bg); min-height: 100vh; padding: 16px; }

  header { text-align: center; margin-bottom: 14px; }
  header h1 { font-family: 'Fredoka One', cursive; font-size: clamp(1.8rem,4vw,2.8rem); color: #2D2D2D; }
  header .subtitle { font-size: 0.95rem; color: #888; font-weight: 600; margin-top: 4px; }

  .top-bar {
    position: sticky; top: 0; z-index: 100;
    background: var(--bg); padding: 8px 0 10px;
    display: flex; align-items: center; justify-content: space-between;
    gap: 8px; flex-wrap: wrap; margin-bottom: 14px;
  }
  .jump-links { display: flex; gap: 6px; flex-wrap: wrap; }
  .jump-link {
    display: flex; align-items: center; gap: 5px;
    padding: 7px 13px; border-radius: 50px;
    text-decoration: none; font-weight: 800; font-size: 0.85rem;
    color: white; box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    transition: transform 0.15s, box-shadow 0.15s;
  }
  .jump-link:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
  .right-bar { display: flex; align-items: center; gap: 8px; }
  .day-badge {
    font-family: 'Fredoka One', cursive; font-size: 0.9rem; padding: 7px 14px;
    border-radius: 50px; color: white; box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  }
  .day-badge.saturday { background: linear-gradient(135deg,#f7971e,#ffd200); color: #333; }
  .day-badge.sunday   { background: linear-gradient(135deg,#667eea,#764ba2); }
  .sync-indicator {
    display: flex; align-items: center; gap: 7px; font-size: 0.8rem; font-weight: 700;
    color: #aaa; background: white; padding: 7px 14px; border-radius: 50px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.07); white-space: nowrap;
  }
  .sync-indicator.syncing { color: #f7971e; }
  .sync-indicator.synced  { color: #43e97b; }
  .sync-indicator.error   { color: #f5576c; }
  .sync-dot { width: 8px; height: 8px; border-radius: 50%; background: currentColor; }
  .sync-dot.spinning { animation: pulse 0.8s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.4;transform:scale(0.8)} }

  .summary-bar { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; margin-bottom: 18px; }
  .summary-item {
    background: white; padding: 7px 16px; border-radius: 50px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.06); font-size: 0.88rem; font-weight: 700; color: #555;
  }

  .kids-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px,1fr)); gap: 18px; max-width: 1400px; margin: 0 auto; }

  .kid-card { background: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; scroll-margin-top: 80px; }

  .kid-header { padding: 16px 20px 12px; display: flex; align-items: center; gap: 14px; position: relative; }

  /* Avatar - tappable */
  .kid-avatar {
    width: 54px; height: 54px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.6rem; flex-shrink: 0; cursor: pointer;
    transition: transform 0.15s, box-shadow 0.15s;
    position: relative;
  }
  .kid-avatar:hover { transform: scale(1.1); box-shadow: 0 4px 16px rgba(0,0,0,0.2); }
  .kid-avatar:active { transform: scale(0.95); }

  .kid-info h2 { font-family: 'Fredoka One', cursive; font-size: 1.3rem; color: #2D2D2D; }
  .kid-age { font-size: 0.72rem; font-weight: 700; color: #999; text-transform: uppercase; letter-spacing: 1px; }
  .progress-bar-wrap { height: 7px; background: #F0F0F0; border-radius: 4px; overflow: hidden; margin-top: 7px; }
  .progress-bar { height: 100%; border-radius: 4px; transition: width 0.4s ease; }
  .score-badge {
    position: absolute; top: 16px; right: 16px; font-family: 'Fredoka One', cursive;
    font-size: 1rem; padding: 4px 12px; border-radius: 50px; color: white;
  }

  .tod-divider { display: flex; align-items: center; gap: 8px; padding: 10px 14px 3px; }
  .tod-divider-label { font-size: 0.7rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; white-space: nowrap; }
  .tod-divider-line  { flex: 1; height: 1.5px; border-radius: 1px; }
  .tod-morning   .tod-divider-label { color: #f7971e; }
  .tod-morning   .tod-divider-line  { background: #f7971e44; }
  .tod-afternoon .tod-divider-label { color: #38c172; }
  .tod-afternoon .tod-divider-line  { background: #38c17244; }
  .tod-evening   .tod-divider-label { color: #764ba2; }
  .tod-evening   .tod-divider-line  { background: #764ba244; }

  .chore-list { padding: 0 14px 14px; }
  .chore-item {
    display: flex; align-items: center; gap: 12px;
    padding: 9px 10px; border-radius: 12px; margin-bottom: 3px;
    cursor: pointer; transition: background 0.15s; user-select: none;
  }
  .chore-item:hover  { background: #F8F8F8; }
  .chore-item:active { background: #F0F0F0; }
  .chore-item.done   { opacity: 0.45; }
  .chore-check {
    width: 24px; height: 24px; border-radius: 50%; border: 2.5px solid #DDD;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0; transition: all 0.2s; font-size: 0.85rem; color: white;
  }
  .chore-item.done .chore-check { border-color: transparent; }
  .chore-item.done .chore-label { text-decoration: line-through; color: #AAA; }
  .chore-label { font-size: 0.88rem; font-weight: 700; color: #333; flex: 1; }
  .chore-time  { font-size: 0.65rem; color: #bbb; font-weight: 600; }
  .chore-icon  { font-size: 1rem; }

  /* Section complete flash */
  .tod-complete-flash { animation: sectionFlash 0.5s ease; }
  @keyframes sectionFlash { 0%{background:#fff} 40%{background:#d4f5d4} 100%{background:#fff} }


  .confetti-pop { animation: pop 0.25s ease; }
  @keyframes pop { 0%{transform:scale(1)} 50%{transform:scale(1.12)} 100%{transform:scale(1)} }

  /* ---- AVATAR PICKER MODAL ---- */
  .modal-overlay {
    display: none; position: fixed; inset: 0; z-index: 999;
    background: rgba(0,0,0,0.5); align-items: center; justify-content: center;
    backdrop-filter: blur(4px);
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: white; border-radius: 24px; padding: 24px;
    max-width: 420px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    animation: modalIn 0.2s ease;
  }
  @keyframes modalIn { from{transform:scale(0.85);opacity:0} to{transform:scale(1);opacity:1} }
  .modal h3 { font-family: 'Fredoka One', cursive; font-size: 1.4rem; color: #2D2D2D; margin-bottom: 16px; text-align: center; }
  .emoji-grid {
    display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px;
    max-height: 340px; overflow-y: auto; margin-bottom: 16px;
  }
  .emoji-opt {
    padding: 8px 4px; border-radius: 12px; cursor: pointer;
    text-align: center; transition: background 0.1s, transform 0.1s; border: 2.5px solid transparent;
  }
  .av-thumb { width: 48px; height: 48px; margin: 0 auto; display: block; }
  .av-thumb svg { width: 48px; height: 48px; display: block; }
  .av-label { font-size: 7px; color: #999; margin-top: 3px; font-family: Nunito,sans-serif; font-weight: 700; overflow: hidden; white-space: nowrap; max-width: 72px; text-overflow: ellipsis; }
  .emoji-opt:hover  { background: #F0F0F0; transform: scale(1.1); }
  .emoji-opt.picked { border-color: #667eea; background: #667eea18; }
  .modal-close {
    display: block; width: 100%; padding: 10px; border-radius: 50px;
    border: 2px solid #EEE; background: white; font-family: 'Nunito', sans-serif;
    font-weight: 700; font-size: 0.95rem; cursor: pointer; color: #888; transition: all 0.15s;
  }
  .modal-close:hover { border-color: #ccc; color: #555; }

  /* ---- CELEBRATION OVERLAY ---- */
  .celebration {
    display: none; position: fixed; inset: 0; z-index: 998;
    align-items: center; justify-content: center; pointer-events: none;
  }
  .celebration.show { display: flex; }
  .celebration-inner {
    text-align: center; animation: celebIn 0.4s ease;
  }
  @keyframes celebIn { from{transform:scale(0.5);opacity:0} to{transform:scale(1);opacity:1} }
  .celebration-emoji { font-size: 5rem; display: block; }
  .celebration-text  { font-family: 'Fredoka One', cursive; font-size: 2rem; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.4); }

  .confetti-canvas { position: fixed; inset: 0; z-index: 997; pointer-events: none; }

  /* Kid color themes */
  .kid-theodore .kid-header { background: linear-gradient(135deg,#667eea22,#764ba222); }
  .kid-theodore .kid-avatar { background: linear-gradient(135deg,#667eea,#764ba2); }
  .kid-theodore .progress-bar { background: linear-gradient(90deg,#667eea,#764ba2); }
  .kid-theodore .score-badge { background: linear-gradient(135deg,#667eea,#764ba2); }
  .kid-theodore .chore-item.done .chore-check { background: linear-gradient(135deg,#667eea,#764ba2); }
  .jump-theodore { background: linear-gradient(135deg,#667eea,#764ba2); }

  .kid-alice .kid-header { background: linear-gradient(135deg,#f093fb22,#f5576c22); }
  .kid-alice .kid-avatar { background: linear-gradient(135deg,#f093fb,#f5576c); }
  .kid-alice .progress-bar { background: linear-gradient(90deg,#f093fb,#f5576c); }
  .kid-alice .score-badge { background: linear-gradient(135deg,#f093fb,#f5576c); }
  .kid-alice .chore-item.done .chore-check { background: linear-gradient(135deg,#f093fb,#f5576c); }
  .jump-alice { background: linear-gradient(135deg,#f093fb,#f5576c); }

  .kid-andrew .kid-header { background: linear-gradient(135deg,#4facfe22,#00f2fe22); }
  .kid-andrew .kid-avatar { background: linear-gradient(135deg,#4facfe,#00f2fe); }
  .kid-andrew .progress-bar { background: linear-gradient(90deg,#4facfe,#00f2fe); }
  .kid-andrew .score-badge { background: linear-gradient(135deg,#4facfe,#00f2fe); }
  .kid-andrew .chore-item.done .chore-check { background: linear-gradient(135deg,#4facfe,#00f2fe); }
  .jump-andrew { background: linear-gradient(135deg,#4facfe,#00f2fe); }

  .kid-felix .kid-header { background: linear-gradient(135deg,#43e97b22,#38f9d722); }
  .kid-felix .kid-avatar { background: linear-gradient(135deg,#43e97b,#38f9d7); }
  .kid-felix .progress-bar { background: linear-gradient(90deg,#43e97b,#38f9d7); }
  .kid-felix .score-badge { background: linear-gradient(135deg,#43e97b,#38f9d7); }
  .kid-felix .chore-item.done .chore-check { background: linear-gradient(135deg,#43e97b,#38f9d7); }
  .jump-felix { background: linear-gradient(135deg,#43e97b,#38f9d7); }

  .kid-lucy .kid-header { background: linear-gradient(135deg,#fa709a22,#fee14022); }
  .kid-lucy .kid-avatar { background: linear-gradient(135deg,#fa709a,#fee140); }
  .kid-lucy .progress-bar { background: linear-gradient(90deg,#fa709a,#fee140); }
  .kid-lucy .score-badge { background: linear-gradient(135deg,#fa709a,#fee140); }
  .kid-lucy .chore-item.done .chore-check { background: linear-gradient(135deg,#fa709a,#fee140); }
  .jump-lucy { background: linear-gradient(135deg,#fa709a,#fee140); }

  .kid-leo .kid-header { background: linear-gradient(135deg,#f7971e22,#ffd20022); }
  .kid-leo .kid-avatar { background: linear-gradient(135deg,#f7971e,#ffd200); }
  .kid-leo .progress-bar { background: linear-gradient(90deg,#f7971e,#ffd200); }
  .kid-leo .score-badge { background: linear-gradient(135deg,#f7971e,#ffd200); }
  .kid-leo .chore-item.done .chore-check { background: linear-gradient(135deg,#f7971e,#ffd200); }
  .jump-leo { background: linear-gradient(135deg,#f7971e,#ffd200); }
</style>
</head>
<body>

<header>
  <h1>‚≠ê Hull Family Chores</h1>
  <p class="subtitle" id="headerSubtitle"></p>
</header>

<div class="top-bar">
  <div class="jump-links" id="jumpLinks"></div>
  <div class="right-bar">
    <div class="day-badge" id="dayBadge"></div>
    <div class="sync-indicator synced" id="syncIndicator">
      <div class="sync-dot" id="syncDot"></div>
      <span id="syncLabel">Live</span>
    </div>
  </div>
</div>

<div class="summary-bar" id="summaryBar"></div>
<div class="kids-grid" id="kidsGrid"></div>


<!-- Avatar picker modal -->
<div class="modal-overlay" id="avatarModal">
  <div class="modal">
    <h3 id="modalTitle">Pick your avatar!</h3>
    <div class="emoji-grid" id="emojiGrid"></div>
    <button class="modal-close" onclick="closeAvatarModal()">Done ‚úì</button>
  </div>
</div>

<!-- Confetti canvas -->
<canvas class="confetti-canvas" id="confettiCanvas"></canvas>

<!-- Celebration overlay -->
<div class="celebration" id="celebration">
  <div class="celebration-inner">
    <span class="celebration-emoji">üéâ</span>
    <div class="celebration-text" id="celebText"></div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
firebase.initializeApp({
  apiKey: "AIzaSyBImvAIHP_3S9aDl0_yjhwtGG5pf1e5Z7k",
  authDomain: "hull-chores.firebaseapp.com",
  projectId: "hull-chores"
});
var db = firebase.firestore();

// =============================================
// KIDS & AVATARS
// =============================================
var KIDS = [
  { id:'theodore', name:'Theodore', age:11 },
  { id:'alice',    name:'Alice',    age:9 },
  { id:'andrew',   name:'Andrew',   age:8 },
  { id:'felix',    name:'Felix',    age:6 },
  { id:'lucy',     name:'Lucy',     age:5 },
  { id:'leo',      name:'Leo',      age:3 },
];

// Each avatar is { d: display emoji, l: funny label }
var AVATAR_SVGS = [
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><polygon points="10,82 90,82 65,18" fill="#FFD700" stroke="#E6B800" stroke-width="2"/><circle cx="48" cy="62" r="8" fill="#E6A800" opacity="0.5"/><circle cx="33" cy="72" r="5" fill="#E6A800" opacity="0.5"/><circle cx="63" cy="57" r="6" fill="#E6A800" opacity="0.5"/><rect x="30" y="42" width="15" height="10" rx="5" fill="#111"/><rect x="50" y="42" width="15" height="10" rx="5" fill="#111"/><line x1="45" y1="47" x2="50" y2="47" stroke="#111" stroke-width="2.5"/><line x1="30" y1="46" x2="26" y2="43" stroke="#111" stroke-width="2"/><line x1="65" y1="46" x2="69" y2="43" stroke="#111" stroke-width="2"/><path d="M38 60 Q50 70 62 60" stroke="#8B6914" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M28,80 Q15,45 48,22 Q78,5 80,32 Q82,58 52,72 Q40,78 28,80Z" fill="#FFE135" stroke="#E6C820" stroke-width="2"/><path d="M48,22 Q52,19 55,23" stroke="#8B7355" stroke-width="3" fill="none" stroke-linecap="round"/><path d="M28,80 Q25,84 30,86" stroke="#8B7355" stroke-width="3" fill="none" stroke-linecap="round"/><ellipse cx="64" cy="30" rx="19" ry="5" fill="#7B3F00"/><rect x="55" y="11" width="18" height="19" rx="3" fill="#A0522D"/><ellipse cx="64" cy="11" rx="9" ry="3.5" fill="#7B3F00"/><rect x="55" y="25" width="18" height="3.5" fill="#5C2E00"/><circle cx="55" cy="42" r="4.5" fill="white"/><circle cx="56" cy="43" r="2.5" fill="#222"/><circle cx="57" cy="42" r="1" fill="white"/><path d="M48 53 Q55 60 62 53" stroke="#8B7355" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="43" y="62" width="14" height="26" rx="4" fill="#4A7C2F"/><circle cx="50" cy="56" r="17" fill="#3E8B2F"/><circle cx="35" cy="60" r="13" fill="#3E8B2F"/><circle cx="65" cy="60" r="13" fill="#3E8B2F"/><circle cx="50" cy="43" r="12" fill="#52A83A"/><circle cx="37" cy="48" r="10" fill="#52A83A"/><circle cx="63" cy="48" r="10" fill="#52A83A"/><circle cx="43" cy="57" r="5" fill="white"/><circle cx="57" cy="57" r="5" fill="white"/><circle cx="44" cy="58" r="2.5" fill="#111"/><circle cx="58" cy="58" r="2.5" fill="#111"/><line x1="37" y1="51" x2="48" y2="54" stroke="#2E6B22" stroke-width="2.5" stroke-linecap="round"/><line x1="52" y1="54" x2="63" y2="51" stroke="#2E6B22" stroke-width="2.5" stroke-linecap="round"/><path d="M41 66 Q50 61 59 66" stroke="#2E6B22" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><ellipse cx="50" cy="80" rx="28" ry="11" fill="#7B3F00"/><ellipse cx="50" cy="71" rx="22" ry="13" fill="#8B4513"/><ellipse cx="50" cy="60" rx="17" ry="13" fill="#9B5523"/><ellipse cx="50" cy="49" rx="12" ry="12" fill="#A0522D"/><ellipse cx="50" cy="39" rx="8" ry="9" fill="#8B4513"/><path d="M50,30 Q57,25 56,32" stroke="#6B3410" stroke-width="3" fill="none" stroke-linecap="round"/><rect x="31" y="18" width="38" height="13" rx="2" fill="#FFD700"/><polygon points="31,18 37,7 43,18" fill="#FFD700"/><polygon points="44,18 50,7 56,18" fill="#FFD700"/><polygon points="57,18 63,7 69,18" fill="#FFD700"/><circle cx="37" cy="13" r="3" fill="#FF4444"/><circle cx="50" cy="11" r="3" fill="#44EE44"/><circle cx="63" cy="13" r="3" fill="#4488FF"/><circle cx="44" cy="50" r="4" fill="white"/><circle cx="56" cy="50" r="4" fill="white"/><circle cx="45" cy="51" r="2" fill="#333"/><circle cx="57" cy="51" r="2" fill="#333"/><path d="M43 59 Q50 65 57 59" stroke="#6B3410" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><ellipse cx="50" cy="72" rx="32" ry="13" fill="#C8832A"/><rect x="16" y="50" width="68" height="22" rx="11" fill="#B84030"/><path d="M22,61 Q32,54 42,61 Q52,68 62,61 Q72,54 78,61" stroke="#FFD700" stroke-width="3.5" fill="none" stroke-linecap="round"/><ellipse cx="50" cy="52" rx="32" ry="13" fill="#E8A84C"/><ellipse cx="38" cy="47" rx="3" ry="1.8" fill="#C8832A" transform="rotate(-20 38 47)"/><ellipse cx="52" cy="45" rx="3" ry="1.8" fill="#C8832A" transform="rotate(10 52 45)"/><ellipse cx="64" cy="47" rx="3" ry="1.8" fill="#C8832A" transform="rotate(-15 64 47)"/><rect x="31" y="55" width="14" height="9" rx="4.5" fill="#111"/><rect x="51" y="55" width="14" height="9" rx="4.5" fill="#111"/><line x1="45" y1="59" x2="51" y2="59" stroke="#111" stroke-width="2.5"/><line x1="31" y1="59" x2="27" y2="56" stroke="#111" stroke-width="2"/><line x1="65" y1="59" x2="69" y2="56" stroke="#111" stroke-width="2"/><path d="M37 67 Q50 75 63 67" stroke="#8B3A1A" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M20,90 L20,50 Q20,20 50,20 Q80,20 80,50 L80,90 Q70,82 60,90 Q50,82 40,90 Q30,82 20,90Z" fill="#F0F0F0" stroke="#ddd" stroke-width="1"/><polygon points="50,5 38,35 62,35" fill="#FF69B4"/><polygon points="50,5 44,35 56,35" fill="#FF1493"/><ellipse cx="50" cy="35" rx="12" ry="4" fill="#FF69B4"/><line x1="50" y1="5" x2="62" y2="0" stroke="#FFD700" stroke-width="2"/><circle cx="63" cy="0" r="4" fill="#FFD700"/><circle cx="38" cy="52" r="8" fill="#333"/><circle cx="62" cy="52" r="8" fill="#333"/><circle cx="40" cy="50" r="3" fill="white"/><circle cx="64" cy="50" r="3" fill="white"/><path d="M38 68 Q50 78 62 68" stroke="#bbb" stroke-width="3" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><ellipse cx="50" cy="58" rx="30" ry="35" fill="#5DBB3A"/><ellipse cx="50" cy="40" rx="22" ry="18" fill="#90EE90"/><ellipse cx="36" cy="50" rx="11" ry="8" fill="#111"/><ellipse cx="64" cy="50" rx="11" ry="8" fill="#111"/><ellipse cx="36" cy="50" rx="7" ry="5" fill="#9B59FF"/><ellipse cx="64" cy="50" rx="7" ry="5" fill="#9B59FF"/><ellipse cx="36" cy="50" rx="3" ry="3" fill="black"/><ellipse cx="64" cy="50" rx="3" ry="3" fill="black"/><path d="M42 72 Q50 79 58 72" stroke="#4A9900" stroke-width="2.5" fill="none" stroke-linecap="round"/><ellipse cx="50" cy="28" rx="24" ry="6" fill="#8B4513"/><rect x="36" y="10" width="28" height="18" rx="4" fill="#A0522D"/><ellipse cx="50" cy="10" rx="14" ry="4" fill="#8B4513"/><rect x="36" y="23" width="28" height="4" fill="#654321"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="22" y="42" width="56" height="45" rx="8" fill="#8AAABE"/><rect x="30" y="48" width="16" height="14" rx="3" fill="#111"/><rect x="54" y="48" width="16" height="14" rx="3" fill="#111"/><rect x="34" y="52" width="8" height="6" rx="1" fill="#00BFFF" opacity="0.8"/><rect x="58" y="52" width="8" height="6" rx="1" fill="#00BFFF" opacity="0.8"/><rect x="38" y="68" width="24" height="5" rx="2" fill="#668"/><circle cx="50" cy="70" r="3" fill="#FF4444"/><rect x="15" y="55" width="10" height="18" rx="4" fill="#9AAFC3"/><rect x="75" y="55" width="10" height="18" rx="4" fill="#9AAFC3"/><rect x="40" y="87" width="8" height="10" rx="3" fill="#9AAFC3"/><rect x="52" y="87" width="8" height="10" rx="3" fill="#9AAFC3"/><ellipse cx="50" cy="30" rx="18" ry="22" fill="white" stroke="#ddd" stroke-width="1"/><ellipse cx="50" cy="42" rx="22" ry="6" fill="white" stroke="#ddd" stroke-width="1"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="56" r="30" fill="#F4A460"/><circle cx="50" cy="56" r="14" fill="#FFF9F0"/><circle cx="50" cy="44" r="30" fill="#FFB6C1"/><circle cx="50" cy="44" r="14" fill="#FFF9F0"/><circle cx="36" cy="36" r="3" fill="#FF69B4"/><circle cx="50" cy="33" r="3" fill="#9B59FF"/><circle cx="64" cy="36" r="3" fill="#FFD700"/><circle cx="67" cy="48" r="3" fill="#FF69B4"/><circle cx="33" cy="48" r="3" fill="#9B59FF"/><rect x="26" y="19" width="48" height="8" rx="2" fill="#222"/><polygon points="50,4 26,19 74,19" fill="#333"/><rect x="66" y="19" width="3" height="14" fill="#333"/><circle cx="68" cy="34" r="4" fill="#FFD700"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M15,75 Q50,20 85,75 Z" fill="#E8C87A"/><path d="M20,74 Q50,30 80,74" fill="#CC3300" opacity="0.85"/><ellipse cx="50" cy="68" rx="26" ry="8" fill="#8BC34A"/><circle cx="38" cy="58" r="6" fill="#FF6B35"/><circle cx="54" cy="53" r="5" fill="#FF6B35"/><circle cx="66" cy="61" r="5" fill="#FF6B35"/><rect x="28" y="44" width="44" height="18" rx="4" fill="#111" opacity="0.9"/><ellipse cx="40" cy="50" rx="7" ry="5" fill="#111"/><ellipse cx="60" cy="50" rx="7" ry="5" fill="#111"/><circle cx="41" cy="50" r="2" fill="white"/><circle cx="61" cy="50" r="2" fill="white"/><path d="M28,44 Q50,38 72,44" stroke="#111" stroke-width="2" fill="none"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><ellipse cx="50" cy="65" rx="36" ry="22" fill="#4A8AC4"/><path d="M50,43 L58,20 L66,43" fill="#4A8AC4"/><ellipse cx="50" cy="65" rx="30" ry="16" fill="#7EB8E8"/><ellipse cx="50" cy="72" rx="25" ry="8" fill="white"/><path d="M32,72 Q36,76 40,72 Q44,68 48,72 Q52,76 56,72 Q60,68 64,72 Q68,76 72,72" fill="white"/><circle cx="36" cy="60" r="6" fill="white"/><circle cx="37" cy="60" r="3" fill="#111"/><circle cx="64" cy="60" r="6" fill="white"/><circle cx="65" cy="60" r="3" fill="#111"/><polygon points="50,28 38,55 62,55" fill="#FF69B4"/><polygon points="50,28 44,55 56,55" fill="#FF1493"/><ellipse cx="50" cy="55" rx="12" ry="4" fill="#FF69B4"/><line x1="50" y1="28" x2="62" y2="22" stroke="#FFD700" stroke-width="2"/><circle cx="64" cy="21" r="4" fill="#FFD700"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><ellipse cx="50" cy="58" rx="28" ry="36" fill="#5A8A2E"/><ellipse cx="50" cy="62" rx="22" ry="28" fill="#90C84A"/><ellipse cx="50" cy="65" rx="14" ry="18" fill="#F5E642"/><circle cx="50" cy="68" r="10" fill="#8B4513"/><circle cx="50" cy="68" r="7" fill="#A0522D"/><rect x="28" y="47" width="17" height="11" rx="5.5" fill="#111"/><rect x="51" y="47" width="17" height="11" rx="5.5" fill="#111"/><line x1="45" y1="52" x2="51" y2="52" stroke="#333" stroke-width="2.5"/><line x1="28" y1="52" x2="24" y2="49" stroke="#111" stroke-width="2"/><line x1="68" y1="52" x2="72" y2="49" stroke="#111" stroke-width="2"/><path d="M40 40 Q50 34 60 40" stroke="#4A7A20" stroke-width="2" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><ellipse cx="52" cy="68" rx="24" ry="18" fill="#5CB85C"/><path d="M34,55 Q28,40 38,35 Q48,30 55,40 L70,35 Q78,30 80,42 Q82,55 68,58 L60,68 Q56,75 52,68 Z" fill="#5CB85C"/><ellipse cx="72" cy="44" rx="12" ry="8" fill="#5CB85C"/><circle cx="76" cy="40" r="5" fill="white"/><circle cx="77" cy="40" r="2.5" fill="#111"/><path d="M62,48 L68,42 L74,48" stroke="#fff" stroke-width="1.5" fill="none"/><path d="M34,55 Q30,62 28,72 L36,72 Q37,65 40,60" fill="#4CAF50"/><path d="M52,68 Q44,78 42,88 L50,88 Q52,80 56,72" fill="#4CAF50"/><rect x="56" y="15" width="22" height="5" rx="1" fill="#222"/><rect x="60" y="4" width="14" height="12" rx="2" fill="#333"/><ellipse cx="67" cy="4" rx="7" ry="2.5" fill="#222"/><rect x="60" y="14" width="14" height="3" fill="#444"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50,85 Q25,75 20,55 Q15,35 30,28 Q38,24 50,30 Q62,24 70,28 Q85,35 80,55 Q75,75 50,85Z" fill="#FF4444"/><circle cx="36" cy="44" r="4" fill="#FF9090" opacity="0.6"/><circle cx="65" cy="50" r="3.5" fill="#FF9090" opacity="0.6"/><path d="M38,22 Q34,14 38,10" stroke="#4CAF50" stroke-width="4" fill="none" stroke-linecap="round"/><path d="M50,20 Q50,12 52,8" stroke="#4CAF50" stroke-width="4" fill="none" stroke-linecap="round"/><path d="M62,22 Q66,14 62,10" stroke="#4CAF50" stroke-width="4" fill="none" stroke-linecap="round"/><circle cx="38" cy="54" r="6" fill="white"/><circle cx="62" cy="54" r="6" fill="white"/><circle cx="39" cy="55" r="3" fill="#111"/><circle cx="63" cy="55" r="3" fill="#111"/><path d="M40 67 Q50 76 60 67" stroke="#CC0000" stroke-width="2.5" fill="none" stroke-linecap="round"/><path d="M36,46 Q28,38 24,30 L20,34 Q18,28 22,24 L28,30 Q30,22 36,18" stroke="#FFD700" stroke-width="2" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M8,88 L50,8 L92,88 Z" fill="#D2691E" stroke="#A0522D" stroke-width="2"/><path d="M16,85 L50,20 L84,85 Z" fill="#FFD700"/><circle cx="38" cy="64" r="9" fill="#CC3300" opacity="0.75"/><circle cx="62" cy="58" r="8" fill="#CC3300" opacity="0.75"/><circle cx="50" cy="75" r="7" fill="#CC3300" opacity="0.75"/><circle cx="39" cy="62" r="6" fill="#8B1A1A"/><circle cx="63" cy="56" r="6" fill="#8B1A1A"/><rect x="31" y="41" width="15" height="10" rx="5" fill="#111"/><rect x="52" y="41" width="15" height="10" rx="5" fill="#111"/><line x1="46" y1="46" x2="52" y2="46" stroke="#222" stroke-width="2.5"/><line x1="31" y1="46" x2="27" y2="43" stroke="#111" stroke-width="2"/><line x1="67" y1="46" x2="71" y2="43" stroke="#111" stroke-width="2"/><path d="M39 60 Q50 70 61 60" stroke="#A0522D" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="36" y="30" width="28" height="55" rx="14" fill="#4CAF50"/><rect x="14" y="42" width="24" height="14" rx="7" fill="#4CAF50"/><rect x="14" y="42" width="8" height="20" rx="4" fill="#4CAF50"/><rect x="62" y="48" width="24" height="14" rx="7" fill="#4CAF50"/><rect x="78" y="42" width="8" height="20" rx="4" fill="#4CAF50"/><line x1="42" y1="38" x2="40" y2="32" stroke="#3D8B40" stroke-width="1.5"/><line x1="50" y1="35" x2="50" y2="30" stroke="#3D8B40" stroke-width="1.5"/><line x1="58" y1="38" x2="60" y2="32" stroke="#3D8B40" stroke-width="1.5"/><rect x="34" y="45" width="14" height="10" rx="5" fill="#111"/><rect x="52" y="45" width="14" height="10" rx="5" fill="#111"/><line x1="48" y1="50" x2="52" y2="50" stroke="#222" stroke-width="2.5"/><line x1="34" y1="50" x2="30" y2="47" stroke="#111" stroke-width="2"/><line x1="66" y1="50" x2="70" y2="47" stroke="#111" stroke-width="2"/><path d="M40 62 Q50 70 60 62" stroke="#2E7D32" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><ellipse cx="50" cy="52" rx="32" ry="34" fill="#F0F0F0"/><rect x="32" y="74" width="36" height="12" rx="3" fill="#F0F0F0"/><rect x="38" y="77" width="8" height="9" rx="1" fill="#999"/><rect x="54" y="77" width="8" height="9" rx="1" fill="#999"/><ellipse cx="37" cy="52" rx="11" ry="13" fill="#222"/><ellipse cx="63" cy="52" rx="11" ry="13" fill="#222"/><ellipse cx="37" cy="52" rx="7" ry="9" fill="#444"/><ellipse cx="63" cy="52" rx="7" ry="9" fill="#444"/><path d="M40 67 Q50 74 60 67" stroke="#999" stroke-width="2.5" fill="none" stroke-linecap="round"/><ellipse cx="50" cy="14" rx="14" ry="6" fill="#FF69B4"/><ellipse cx="50" cy="14" rx="6" ry="14" fill="#FF69B4"/><ellipse cx="50" cy="14" rx="14" ry="6" fill="#FF69B4" transform="rotate(45 50 14)"/><ellipse cx="50" cy="14" rx="14" ry="6" fill="#FF69B4" transform="rotate(-45 50 14)"/><circle cx="50" cy="14" r="5" fill="#FFD700"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><ellipse cx="50" cy="65" rx="30" ry="26" fill="#999"/><path d="M24,52 L20,32 L36,48 Z" fill="#999"/><path d="M76,52 L80,32 L64,48 Z" fill="#999"/><ellipse cx="50" cy="65" rx="24" ry="20" fill="#BBB"/><ellipse cx="50" cy="72" rx="16" ry="10" fill="#CCC"/><ellipse cx="38" cy="60" rx="8" ry="6" fill="#222"/><ellipse cx="62" cy="60" rx="8" ry="6" fill="#222"/><ellipse cx="38" cy="60" rx="3" ry="5" fill="#111"/><ellipse cx="62" cy="60" rx="3" ry="5" fill="#111"/><ellipse cx="50" cy="69" rx="4" ry="3" fill="#FFB6C1"/><line x1="26" y1="63" x2="46" y2="67" stroke="#888" stroke-width="1.5"/><line x1="74" y1="63" x2="54" y2="67" stroke="#888" stroke-width="1.5"/><polygon points="50,5 36,45 64,45" fill="#6A0DAD"/><ellipse cx="50" cy="45" rx="14" ry="4" fill="#7B1FA2"/><rect x="42" y="42" width="16" height="5" fill="#7B1FA2"/><circle cx="50" cy="20" r="4" fill="#FFD700" opacity="0.8"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><ellipse cx="50" cy="58" rx="34" ry="30" fill="#C8A96E"/><ellipse cx="50" cy="58" rx="28" ry="24" fill="#D4B87A"/><circle cx="36" cy="48" r="5" fill="#B8985E" opacity="0.5"/><circle cx="62" cy="68" r="4" fill="#B8985E" opacity="0.5"/><circle cx="28" cy="60" r="3" fill="#B8985E" opacity="0.5"/><circle cx="70" cy="50" r="3.5" fill="#B8985E" opacity="0.5"/><rect x="25" y="46" width="50" height="18" rx="4" fill="#111" opacity="0.92"/><ellipse cx="38" cy="52" rx="9" ry="7" fill="#111"/><ellipse cx="62" cy="52" rx="9" ry="7" fill="#111"/><ellipse cx="38" cy="52" rx="5" ry="4" fill="#2244AA"/><ellipse cx="62" cy="52" rx="5" ry="4" fill="#2244AA"/><circle cx="38" cy="52" r="2" fill="#111"/><circle cx="62" cy="52" r="2" fill="#111"/><circle cx="39" cy="51" r="1" fill="white"/><circle cx="63" cy="51" r="1" fill="white"/><line x1="25" y1="55" x2="21" y2="52" stroke="#111" stroke-width="2"/><line x1="75" y1="55" x2="79" y2="52" stroke="#111" stroke-width="2"/><path d="M38 66 Q50 74 62 66" stroke="#8B7345" stroke-width="2.5" fill="none" stroke-linecap="round"/><rect x="42" y="20" width="16" height="3" fill="#111"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><ellipse cx="48" cy="58" rx="30" ry="24" fill="#FF6600"/><path d="M78,58 L92,44 L92,72 Z" fill="#FF6600"/><line x1="30" y1="40" x2="30" y2="76" stroke="white" stroke-width="4"/><line x1="50" y1="36" x2="50" y2="80" stroke="white" stroke-width="4"/><line x1="70" y1="40" x2="70" y2="76" stroke="white" stroke-width="4"/><rect x="34" y="46" width="14" height="9" rx="4.5" fill="#111"/><rect x="54" y="46" width="14" height="9" rx="4.5" fill="#111"/><line x1="48" y1="50" x2="54" y2="50" stroke="#222" stroke-width="2.5"/><line x1="34" y1="50" x2="30" y2="47" stroke="#111" stroke-width="2"/><line x1="68" y1="50" x2="72" y2="47" stroke="#111" stroke-width="2"/><path d="M36 62 Q48 70 58 62" stroke="#E65C00" stroke-width="2" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M30,90 L50,20 L70,90 Z" fill="#F5DEB3"/><path d="M36,90 L50,35 L64,90" fill="#FFCC80"/><circle cx="50" cy="22" r="18" fill="#76C442"/><circle cx="50" cy="22" r="14" fill="#90EE90"/><circle cx="44" cy="18" r="5" fill="white"/><circle cx="56" cy="18" r="5" fill="white"/><circle cx="45" cy="19" r="2.5" fill="#111"/><circle cx="57" cy="19" r="2.5" fill="#111"/><path d="M43 28 Q50 34 57 28" stroke="#4A9900" stroke-width="2" fill="none" stroke-linecap="round"/><path d="M42,8 L40,2 L46,6 L44,0 L50,5 L56,0 L54,6 L60,2 L58,8" fill="#FF4444" stroke="#CC0000" stroke-width="0.5"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="36" y="18" width="28" height="68" rx="14" fill="#FFD700"/><rect x="30" y="24" width="40" height="56" rx="12" fill="#FFEB3B"/><rect x="34" y="30" width="5" height="5" rx="1" fill="#E6C200"/><rect x="42" y="28" width="5" height="5" rx="1" fill="#E6C200"/><rect x="50" y="30" width="5" height="5" rx="1" fill="#E6C200"/><rect x="58" y="28" width="5" height="5" rx="1" fill="#E6C200"/><rect x="34" y="38" width="5" height="5" rx="1" fill="#E6C200"/><rect x="42" y="36" width="5" height="5" rx="1" fill="#E6C200"/><rect x="50" y="38" width="5" height="5" rx="1" fill="#E6C200"/><rect x="58" y="36" width="5" height="5" rx="1" fill="#E6C200"/><rect x="26" y="48" width="16" height="11" rx="5.5" fill="#111"/><rect x="46" y="48" width="16" height="11" rx="5.5" fill="#111"/><line x1="42" y1="53" x2="46" y2="53" stroke="#222" stroke-width="2.5"/><line x1="26" y1="53" x2="22" y2="50" stroke="#111" stroke-width="2"/><line x1="62" y1="53" x2="66" y2="50" stroke="#111" stroke-width="2"/><path d="M34 66 Q44 74 58 66" stroke="#E6A800" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><ellipse cx="50" cy="60" rx="26" ry="34" fill="#7D3C98"/><ellipse cx="50" cy="60" rx="22" ry="28" fill="#9B59B6"/><path d="M44,26 Q46,16 50,14 Q54,16 56,26" fill="#4CAF50" stroke="#388E3C" stroke-width="1"/><path d="M50,14 Q48,8 50,6 Q52,8 50,14" fill="#4CAF50"/><circle cx="50" cy="20" r="5" fill="#5DBB3A" opacity="0.7"/><circle cx="40" cy="52" r="6" fill="white"/><circle cx="60" cy="52" r="6" fill="white"/><circle cx="41" cy="53" r="3" fill="#111"/><circle cx="61" cy="53" r="3" fill="#111"/><path d="M36 44 Q38 40 44 43" stroke="#7D3C98" stroke-width="2" fill="none" stroke-linecap="round"/><path d="M56 43 Q62 40 64 44" stroke="#7D3C98" stroke-width="2" fill="none" stroke-linecap="round"/><path d="M40 65 Q50 74 60 65" stroke="#5E2280" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><ellipse cx="50" cy="54" rx="32" ry="28" fill="#FF69B4"/><path d="M18,54 Q18,38 28,36 Q24,30 30,28 Q28,20 36,22 Q36,14 44,18 Q46,10 50,12 Q54,10 56,18 Q64,14 64,22 Q70,20 70,28 Q76,30 72,36 Q82,38 82,54 Z" fill="#FF88BB"/><path d="M50,12 Q50,50 50,82" stroke="#CC4488" stroke-width="1.5" fill="none"/><path d="M30,30 Q50,45 70,30" stroke="#CC4488" stroke-width="1.5" fill="none"/><path d="M24,50 Q50,58 76,50" stroke="#CC4488" stroke-width="1.5" fill="none"/><circle cx="38" cy="57" r="5" fill="white"/><circle cx="62" cy="57" r="5" fill="white"/><circle cx="39" cy="58" r="2.5" fill="#111"/><circle cx="63" cy="58" r="2.5" fill="#111"/><path d="M40 67 Q50 76 60 67" stroke="#CC4488" stroke-width="2.5" fill="none" stroke-linecap="round"/><rect x="42" y="2" width="16" height="12" rx="3" fill="#AA2266"/><rect x="34" y="2" width="32" height="4" rx="2" fill="#AA2266"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><ellipse cx="50" cy="55" rx="32" ry="35" fill="#C8A96E"/><ellipse cx="50" cy="20" rx="28" ry="12" fill="#D4B87A"/><ellipse cx="50" cy="88" rx="28" ry="12" fill="#B89855"/><path d="M18,28 Q22,55 18,82" stroke="#B89855" stroke-width="3" fill="none"/><path d="M82,28 Q78,55 82,82" stroke="#B89855" stroke-width="3" fill="none"/><circle cx="40" cy="50" r="8" fill="#CC3300" opacity="0.4"/><circle cx="62" cy="44" r="7" fill="#4CAF50" opacity="0.5"/><circle cx="52" cy="62" r="8" fill="#FFD700" opacity="0.4"/><circle cx="38" cy="52" r="6" fill="white"/><circle cx="62" cy="52" r="6" fill="white"/><circle cx="39" cy="53" r="3" fill="#111"/><circle cx="63" cy="53" r="3" fill="#111"/><path d="M40 65 Q50 73 60 65" stroke="#8B6914" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="26" fill="#FFD700"/><circle cx="50" cy="50" r="22" fill="#FFEB3B"/><line x1="50" y1="8" x2="50" y2="16" stroke="#FFD700" stroke-width="4" stroke-linecap="round"/><line x1="50" y1="84" x2="50" y2="92" stroke="#FFD700" stroke-width="4" stroke-linecap="round"/><line x1="8" y1="50" x2="16" y2="50" stroke="#FFD700" stroke-width="4" stroke-linecap="round"/><line x1="84" y1="50" x2="92" y2="50" stroke="#FFD700" stroke-width="4" stroke-linecap="round"/><line x1="20" y1="20" x2="26" y2="26" stroke="#FFD700" stroke-width="4" stroke-linecap="round"/><line x1="74" y1="20" x2="80" y2="26" stroke="#FFD700" stroke-width="4" stroke-linecap="round"/><line x1="20" y1="80" x2="26" y2="74" stroke="#FFD700" stroke-width="4" stroke-linecap="round"/><line x1="80" y1="74" x2="74" y2="80" stroke="#FFD700" stroke-width="4" stroke-linecap="round"/><rect x="30" y="42" width="17" height="11" rx="5.5" fill="#111"/><rect x="53" y="42" width="17" height="11" rx="5.5" fill="#111"/><line x1="47" y1="47" x2="53" y2="47" stroke="#222" stroke-width="2.5"/><line x1="30" y1="47" x2="26" y2="44" stroke="#111" stroke-width="2"/><line x1="70" y1="47" x2="74" y2="44" stroke="#111" stroke-width="2"/><path d="M38 60 Q50 70 62 60" stroke="#E6A800" stroke-width="2.5" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><ellipse cx="50" cy="45" rx="38" ry="28" fill="#FF7043"/><ellipse cx="50" cy="45" rx="32" ry="22" fill="#FF8A65"/><circle cx="34" cy="38" r="6" fill="#FFCCBC" opacity="0.7"/><circle cx="52" cy="30" r="7" fill="#FFCCBC" opacity="0.7"/><circle cx="68" cy="40" r="5" fill="#FFCCBC" opacity="0.7"/><rect x="36" y="60" width="28" height="26" rx="6" fill="#F5DEB3"/><rect x="36" y="60" width="28" height="26" rx="6" fill="#EDD9A3"/><circle cx="42" cy="70" r="5" fill="white"/><circle cx="58" cy="70" r="5" fill="white"/><circle cx="43" cy="71" r="2.5" fill="#111"/><circle cx="59" cy="71" r="2.5" fill="#111"/><circle cx="44" cy="70" r="1" fill="white"/><circle cx="60" cy="70" r="1" fill="white"/><path d="M42 79 Q50 86 58 79" stroke="#C8A96E" stroke-width="2" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M30,88 L50,18 L70,88 Z" fill="#E8C87A"/><circle cx="50" cy="20" r="18" fill="#FF69B4"/><circle cx="36" cy="14" r="12" fill="#FFB6C1"/><circle cx="64" cy="14" r="12" fill="#FF85A2"/><circle cx="50" cy="22" r="10" fill="#FF69B4"/><path d="M42,8 Q38,2 40,6 Q42,2 44,6 Q46,2 48,6 Q50,2 52,6 Q54,2 56,6 Q58,2 60,6" stroke="#FF1493" stroke-width="1.5" fill="none"/><circle cx="42" cy="22" r="5" fill="white"/><circle cx="58" cy="22" r="5" fill="white"/><circle cx="43" cy="23" r="2.5" fill="#111"/><circle cx="59" cy="23" r="2.5" fill="#111"/><line x1="37" y1="17" x2="47" y2="20" stroke="#CC0066" stroke-width="2" stroke-linecap="round"/><line x1="53" y1="20" x2="63" y2="17" stroke="#CC0066" stroke-width="2" stroke-linecap="round"/><path d="M41 31 Q50 26 59 31" stroke="#CC0066" stroke-width="2" fill="none" stroke-linecap="round"/></svg>',
  '<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="18" y="18" width="64" height="64" rx="10" fill="#D4A843"/><rect x="18" y="18" width="64" height="64" rx="10" fill="#E8C060" opacity="0.5"/><line x1="18" y1="34" x2="82" y2="34" stroke="#C8922A" stroke-width="2"/><line x1="18" y1="50" x2="82" y2="50" stroke="#C8922A" stroke-width="2"/><line x1="18" y1="66" x2="82" y2="66" stroke="#C8922A" stroke-width="2"/><line x1="34" y1="18" x2="34" y2="82" stroke="#C8922A" stroke-width="2"/><line x1="50" y1="18" x2="50" y2="82" stroke="#C8922A" stroke-width="2"/><line x1="66" y1="18" x2="66" y2="82" stroke="#C8922A" stroke-width="2"/><rect x="26" y="38" width="16" height="11" rx="5.5" fill="#111"/><rect x="58" y="38" width="16" height="11" rx="5.5" fill="#111"/><line x1="42" y1="43" x2="58" y2="43" stroke="#222" stroke-width="2.5"/><line x1="26" y1="43" x2="22" y2="40" stroke="#111" stroke-width="2"/><line x1="74" y1="43" x2="78" y2="40" stroke="#111" stroke-width="2"/><path d="M36 60 Q50 70 64 60" stroke="#A87030" stroke-width="3" fill="none" stroke-linecap="round"/></svg>',
];
var AVATAR_LABELS = [
  'Cheese Boss',
  'Banana Cowboy',
  'Angry Broccoli',
  'King Poop',
  'Hot Dog Boss',
  'Party Ghost',
  'Space Cowboy',
  'Chef Robot',
  'Donut Graduate',
  'Taco Ninja',
  'Party Shark',
  'Avo Cool',
  'Fancy Dino',
  'Berry Rocker',
  'Pizza Boss',
  'Desert Cool',
  'Skull Flower',
  'Wizard Cat',
  'Secret Potato',
  'Fishy Fresh',
  'Dino Ice Cream',
  'Corn Sunglasses',
  'Eggplant Diva',
  'Brain Genius',
  'Burrito Roll',
  'Cool Sun',
  'Mushroom Chill',
  'Ice Cream Evil',
  'Waffle Weirdo',
];


// =============================================
// AVATARS - stored as index into AVATAR_SVGS
// =============================================
var avatars = {}; // kidId -> index number

function loadAvatars() {
  try {
    var s = localStorage.getItem('hull_avatars_v2');
    if (s) {
      var p = JSON.parse(s);
      for (var k in p) {
        if (typeof p[k] === 'number') avatars[k] = p[k];
      }
    }
  } catch(e) { avatars = {}; }
}

function saveAvatars() {
  try { localStorage.setItem('hull_avatars_v2', JSON.stringify(avatars)); } catch(e) {}
  db.collection('meta').doc('avatars_v2').set(avatars).catch(function(){});
}

function loadAvatarsRemote() {
  db.collection('meta').doc('avatars_v2').get().then(function(snap) {
    if (snap.exists) {
      var data = snap.data();
      for (var k in data) {
        if (typeof data[k] === 'number') avatars[k] = data[k];
      }
      saveAvatars();
      render();
    }
  }).catch(function(){});
}

// Set the avatar element for a kid directly via DOM - NEVER via string concat
function setAvatarEl(el, kidId) {
  if (!el) return;
  var idx = avatars[kidId];
  if (typeof idx === 'number' && AVATAR_SVGS[idx]) {
    el.innerHTML = AVATAR_SVGS[idx];
    // Make SVG fill the container exactly
    var svg = el.querySelector('svg');
    if (svg) { svg.style.width = '100%'; svg.style.height = '100%'; svg.style.display = 'block'; }
  } else {
    el.innerHTML = '';
  }
}


function loadAvatarsRemote() {
  db.collection('meta').doc('avatars').get().then(function(snap) {
    if (snap.exists) {
      var data = snap.data();
      for (var k in data) {
        var v = data[k];
        // Only keep proper SVG avatars
        if (typeof v === 'string' && v.indexOf('<svg') === 0) avatars[k] = v;
      }
            render();
    }
  }).catch(function(){});
}

// =============================================
// AVATAR PICKER
// =============================================
var pickingKidId = null;

function openAvatarModal(kidId) {
  pickingKidId = kidId;
  var kid = KIDS.find(function(k){ return k.id === kidId; });
  document.getElementById('modalTitle').textContent = kid.name + ', pick your vibe!';
  var grid = document.getElementById('emojiGrid');
  var currentIdx = typeof avatars[kidId] === 'number' ? avatars[kidId] : -1;
  var html = '';
  for (var i = 0; i < AVATAR_SVGS.length; i++) {
    var picked = i === currentIdx ? ' picked' : '';
    html += '<div class="emoji-opt' + picked + '" data-idx="' + i + '" onclick="pickAvatar(' + i + ')">' +
      '<div class="av-thumb">' + AVATAR_SVGS[i] + '</div>' +
      '<div class="av-label">' + AVATAR_LABELS[i] + '</div>' +
    '</div>';
  }
  grid.innerHTML = html;
  document.getElementById('avatarModal').classList.add('open');
  soundPop();
}

function pickAvatar(idx) {
  if (pickingKidId === null) return;
  avatars[pickingKidId] = idx;
  saveAvatars();
  // Update highlight in grid
  var opts = document.querySelectorAll('.emoji-opt');
  for (var i = 0; i < opts.length; i++) {
    opts[i].classList.toggle('picked', parseInt(opts[i].getAttribute('data-idx')) === idx);
  }
  // Update card avatar directly via DOM - no re-render needed
  var cardEl = document.getElementById('avatar-' + pickingKidId);
  setAvatarEl(cardEl, pickingKidId);
  // Update jump icon directly via DOM
  var jumpEl = document.getElementById('jav-' + pickingKidId);
  setAvatarEl(jumpEl, pickingKidId);
  soundPop();
}

function closeAvatarModal() {
  document.getElementById('avatarModal').classList.remove('open');
  pickingKidId = null;
}

document.getElementById('avatarModal').addEventListener('click', function(e) {
  if (e.target === this) closeAvatarModal();
});
function closeAvatarModal() {
  document.getElementById('avatarModal').classList.remove('open');
  pickingKidId = null;
}

// Close modal on overlay click
document.getElementById('avatarModal').addEventListener('click', function(e) {
  if (e.target === this) closeAvatarModal();
});

// =============================================
// SOUNDS (Web Audio API)
// =============================================
var audioCtx = null;

function getAudioCtx() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}

// High five slap sound
function soundHighFive() {
  try {
    var ctx = getAudioCtx();
    var bufSize = ctx.sampleRate * 0.15;
    var buf = ctx.createBuffer(1, bufSize, ctx.sampleRate);
    var data = buf.getChannelData(0);
    for (var i = 0; i < bufSize; i++) {
      var t = i / ctx.sampleRate;
      var env = Math.exp(-t * 30);
      data[i] = (Math.random() * 2 - 1) * env * 0.8;
      // Add a little smack tone
      data[i] += Math.sin(2 * Math.PI * 200 * t) * Math.exp(-t * 40) * 0.3;
    }
    var src = ctx.createBufferSource();
    src.buffer = buf;
    var gain = ctx.createGain();
    gain.gain.setValueAtTime(1, ctx.currentTime);
    src.connect(gain); gain.connect(ctx.destination);
    src.start();
  } catch(e) {}
}

// Whoops - uncheck
function soundUncheck() {
  try {
    var ctx = getAudioCtx();
    var osc = ctx.createOscillator();
    var gain = ctx.createGain();
    osc.connect(gain); gain.connect(ctx.destination);
    osc.frequency.setValueAtTime(400, ctx.currentTime);
    osc.frequency.linearRampToValueAtTime(180, ctx.currentTime + 0.25);
    gain.gain.setValueAtTime(0.3, ctx.currentTime);
    gain.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.25);
    osc.start(ctx.currentTime);
    osc.stop(ctx.currentTime + 0.25);
  } catch(e) {}
}

// Section complete - air horn burst
function soundSectionComplete() {
  try {
    var ctx = getAudioCtx();
    var freqs = [466, 587, 698, 880];
    freqs.forEach(function(f, i) {
      var osc = ctx.createOscillator();
      var gain = ctx.createGain();
      osc.type = 'sawtooth';
      osc.frequency.value = f;
      gain.gain.setValueAtTime(0, ctx.currentTime + i * 0.08);
      gain.gain.linearRampToValueAtTime(0.18, ctx.currentTime + i * 0.08 + 0.05);
      gain.gain.linearRampToValueAtTime(0, ctx.currentTime + i * 0.08 + 0.25);
      osc.connect(gain); gain.connect(ctx.destination);
      osc.start(ctx.currentTime + i * 0.08);
      osc.stop(ctx.currentTime + i * 0.08 + 0.3);
    });
  } catch(e) {}
}

// Card complete - fanfare
function soundCardComplete() {
  try {
    var ctx = getAudioCtx();
    var notes = [523, 659, 784, 1047];
    notes.forEach(function(f, i) {
      var osc = ctx.createOscillator();
      var gain = ctx.createGain();
      osc.type = 'triangle';
      osc.frequency.value = f;
      gain.gain.setValueAtTime(0.0, ctx.currentTime + i * 0.12);
      gain.gain.linearRampToValueAtTime(0.3, ctx.currentTime + i * 0.12 + 0.05);
      gain.gain.linearRampToValueAtTime(0.0, ctx.currentTime + i * 0.12 + 0.35);
      osc.connect(gain); gain.connect(ctx.destination);
      osc.start(ctx.currentTime + i * 0.12);
      osc.stop(ctx.currentTime + i * 0.12 + 0.4);
    });
  } catch(e) {}
}

// ALL kids done - absolute chaos
function soundAllDone() {
  try {
    var ctx = getAudioCtx();
    // Siren sweep
    for (var i = 0; i < 3; i++) {
      (function(idx) {
        var osc = ctx.createOscillator();
        var gain = ctx.createGain();
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(600, ctx.currentTime + idx * 0.4);
        osc.frequency.linearRampToValueAtTime(1200, ctx.currentTime + idx * 0.4 + 0.2);
        osc.frequency.linearRampToValueAtTime(600, ctx.currentTime + idx * 0.4 + 0.4);
        gain.gain.setValueAtTime(0.25, ctx.currentTime + idx * 0.4);
        gain.gain.linearRampToValueAtTime(0, ctx.currentTime + idx * 0.4 + 0.4);
        osc.connect(gain); gain.connect(ctx.destination);
        osc.start(ctx.currentTime + idx * 0.4);
        osc.stop(ctx.currentTime + idx * 0.4 + 0.4);
      })(i);
    }
    // Ascending chime
    var chimeNotes = [523,659,784,880,1047,1319];
    chimeNotes.forEach(function(f, i) {
      var osc = ctx.createOscillator();
      var gain = ctx.createGain();
      osc.type = 'sine';
      osc.frequency.value = f;
      gain.gain.setValueAtTime(0, ctx.currentTime + 1.2 + i * 0.1);
      gain.gain.linearRampToValueAtTime(0.35, ctx.currentTime + 1.2 + i * 0.1 + 0.05);
      gain.gain.linearRampToValueAtTime(0, ctx.currentTime + 1.2 + i * 0.1 + 0.4);
      osc.connect(gain); gain.connect(ctx.destination);
      osc.start(ctx.currentTime + 1.2 + i * 0.1);
      osc.stop(ctx.currentTime + 1.2 + i * 0.1 + 0.5);
    });
  } catch(e) {}
}

// Generic pop for UI
function soundPop() {
  try {
    var ctx = getAudioCtx();
    var osc = ctx.createOscillator();
    var gain = ctx.createGain();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(800, ctx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(400, ctx.currentTime + 0.1);
    gain.gain.setValueAtTime(0.2, ctx.currentTime);
    gain.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.1);
    osc.connect(gain); gain.connect(ctx.destination);
    osc.start(); osc.stop(ctx.currentTime + 0.1);
  } catch(e) {}
}

// =============================================
// CONFETTI
// =============================================
var confettiPieces = [];
var confettiAnimating = false;

function launchConfetti(intensity) {
  var canvas = document.getElementById('confettiCanvas');
  canvas.width  = window.innerWidth;
  canvas.height = window.innerHeight;
  var count = intensity === 'big' ? 200 : 80;
  confettiPieces = [];
  for (var i = 0; i < count; i++) {
    confettiPieces.push({
      x: Math.random() * canvas.width,
      y: -10 - Math.random() * 100,
      w: 8 + Math.random() * 8,
      h: 4 + Math.random() * 6,
      color: ['#667eea','#f093fb','#43e97b','#f7971e','#f5576c','#ffd200','#4facfe'][Math.floor(Math.random()*7)],
      vx: (Math.random() - 0.5) * 4,
      vy: 3 + Math.random() * 4,
      rot: Math.random() * 360,
      rotV: (Math.random() - 0.5) * 8,
    });
  }
  if (!confettiAnimating) animateConfetti();
}

function animateConfetti() {
  confettiAnimating = true;
  var canvas = document.getElementById('confettiCanvas');
  var ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  var alive = false;
  for (var i = 0; i < confettiPieces.length; i++) {
    var p = confettiPieces[i];
    p.x  += p.vx; p.y += p.vy; p.rot += p.rotV; p.vy += 0.1;
    if (p.y < canvas.height + 20) alive = true;
    ctx.save();
    ctx.translate(p.x, p.y);
    ctx.rotate(p.rot * Math.PI / 180);
    ctx.fillStyle = p.color;
    ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
    ctx.restore();
  }
  if (alive) { requestAnimationFrame(animateConfetti); }
  else { confettiAnimating = false; ctx.clearRect(0,0,canvas.width,canvas.height); }
}

// =============================================
// CELEBRATION
// =============================================
function showCelebration(text, emoji, intensity) {
  var cel = document.getElementById('celebration');
  document.getElementById('celebText').textContent = text;
  cel.querySelector('.celebration-emoji').textContent = emoji;
  cel.style.background = intensity === 'big'
    ? 'radial-gradient(circle, rgba(102,126,234,0.85), rgba(118,75,162,0.85))'
    : 'radial-gradient(circle, rgba(67,233,123,0.7), rgba(56,249,215,0.7))';
  cel.classList.add('show');
  launchConfetti(intensity);
  setTimeout(function() { cel.classList.remove('show'); }, intensity === 'big' ? 3500 : 2000);
}

// =============================================
// DATA
// =============================================
var BIG_KIDS = ['theodore','alice','andrew','felix'];
var TOD_ORDER  = ['morning','afternoon','evening'];
var TOD_LABELS = { morning:'üåÖ Morning', afternoon:'‚òÄÔ∏è Afternoon', evening:'üåÜ Evening' };

var ROTATION_EPOCH = new Date('2025-03-01T00:00:00');
var MORNING_ROTATION = [
  { label:'Vacuum living room',            icon:'üßπ' },
  { label:'Vacuum front room',             icon:'üßπ' },
  { label:"Fill up Sophie's food & water", icon:'üêæ' },
  { label:'Empty dishwasher',              icon:'üçΩÔ∏è' },
];
var EVENING_ROTATION = [
  { label:'Wipe kitchen counter', icon:'üßΩ' },
  { label:'Wipe kitchen table',   icon:'üßπ' },
  { label:'Tineco kitchen floor', icon:'ü§ñ' },
  { label:'Take out trash',       icon:'üóëÔ∏è' },
];

function getRotationIndex(dateObj) {
  var msPerDay = 24 * 60 * 60 * 1000;
  var diff = Math.floor((dateObj - ROTATION_EPOCH) / msPerDay);
  return ((diff % 4) + 4) % 4;
}

function getRotatedChore(bigKidIndex, rotIdx, arr) {
  return arr[(rotIdx + bigKidIndex) % 4];
}

function buildSaturdayChores(kidId) {
  var chores = [];
  var everyoneMorning = ['Make bed','Brush teeth','Get dressed','Eat breakfast','Bring plates to sink'];
  var morningIcons    = ['üõèÔ∏è','ü™•','üëï','ü•£','ü´ß'];
  for (var i = 0; i < everyoneMorning.length; i++) {
    chores.push({ tod:'morning', section:'Everyone', label:everyoneMorning[i], icon:morningIcons[i] });
  }
  if (kidId==='theodore') { chores.push({tod:'morning',section:'Family Chores',label:'Unload dishwasher',icon:'üçΩÔ∏è'}); chores.push({tod:'morning',section:'Family Chores',label:'Wipe bathroom sink',icon:'üöø'}); }
  if (kidId==='alice'||kidId==='lucy')   chores.push({tod:'morning',section:'Family Chores',label:'Wipe bathroom sink',icon:'üöø'});
  if (kidId==='andrew'||kidId==='felix') chores.push({tod:'morning',section:'Family Chores',label:'Wipe bathroom sink',icon:'üöø'});
  if (kidId==='leo')    chores.push({tod:'morning',section:'Family Chores',label:'Wipe bathroom sink',icon:'üöø'});
  if (kidId==='alice')  chores.push({tod:'morning',section:'Family Chores',label:'Vacuum living room',icon:'üßπ'});
  if (kidId==='andrew') chores.push({tod:'morning',section:'Family Chores',label:'Vacuum front room',icon:'üßπ'});
  if (kidId==='lucy'||kidId==='leo') chores.push({tod:'morning',section:'Family Chores',label:'Put away blankets',icon:'üõãÔ∏è'});
  if (kidId==='felix')  chores.push({tod:'morning',section:'Family Chores',label:"Fill up Sophie's food & water",icon:'üêæ'});
  chores.push({tod:'morning',section:'‚ù§Ô∏è Special',label:'Go kiss Momma good morning!',icon:'üíã'});
  // Afternoon
  chores.push({tod:'afternoon',section:'Everyone',label:'Eat lunch',icon:'ü•™'});
  chores.push({tod:'afternoon',section:'Everyone',label:'Bring lunch plates to sink',icon:'ü´ß'});
  chores.push({tod:'afternoon',section:'Everyone',label:'Help fold laundry',icon:'üëï'});
  chores.push({tod:'afternoon',section:'Everyone',label:'Put away lunch stuff',icon:'üßπ'});
  if (kidId==='andrew') { chores.push({tod:'afternoon',section:'Clean Up',label:'Load dishwasher',icon:'ü´ß'}); chores.push({tod:'afternoon',section:'Clean Up',label:'Take out recyclables',icon:'‚ôªÔ∏è'}); }
  if (kidId==='theodore') chores.push({tod:'afternoon',section:'Bathrooms',label:'Clean pool bathroom',icon:'üöø'});
  if (kidId==='alice')    chores.push({tod:'afternoon',section:'Bathrooms',label:'Clean front bathroom',icon:'üöø'});
  if (kidId==='felix')    chores.push({tod:'afternoon',section:'Bathrooms',label:'Clean basement bathroom',icon:'üöø'});
  // Evening
  chores.push({tod:'evening',section:'Everyone',label:'Eat dinner',icon:'üçΩÔ∏è'});
  chores.push({tod:'evening',section:'Everyone',label:'Bring dinner plates to sink',icon:'ü´ß'});
  chores.push({tod:'evening',section:'Everyone',label:'Eat dessert',icon:'üç®'});
  if (kidId==='theodore') chores.push({tod:'evening',section:'Clean Up',label:'Take out trash',icon:'üóëÔ∏è'});
  if (kidId==='alice')    chores.push({tod:'evening',section:'Clean Up',label:'Wipe kitchen counter',icon:'üßΩ'});
  if (kidId==='andrew')   chores.push({tod:'evening',section:'Clean Up',label:'Take out recyclables',icon:'‚ôªÔ∏è'});
  if (kidId==='felix')    chores.push({tod:'evening',section:'Clean Up',label:'Load dishwasher',icon:'üçΩÔ∏è'});
  if (kidId==='lucy')     chores.push({tod:'evening',section:'Clean Up',label:'Wipe kitchen table',icon:'üßπ'});
  return chores;
}

function buildSundayChores(kidId, dateObj) {
  var chores = [];
  var bigIdx = BIG_KIDS.indexOf(kidId);
  var rotIdx = getRotationIndex(dateObj);
  var everyoneMorning = ['Make bed','Brush teeth','Get dressed for church','Eat breakfast','Bring plates to sink'];
  var morningIcons    = ['üõèÔ∏è','ü™•','‚õ™','ü•£','ü´ß'];
  for (var i = 0; i < everyoneMorning.length; i++) {
    chores.push({ tod:'morning', section:'Everyone', label:everyoneMorning[i], icon:morningIcons[i] });
  }
  if (bigIdx !== -1) { var mc = getRotatedChore(bigIdx, rotIdx, MORNING_ROTATION); chores.push({tod:'morning',section:'Family Chores',label:mc.label,icon:mc.icon}); }
  if (kidId==='lucy'||kidId==='leo') chores.push({tod:'morning',section:'Family Chores',label:'Put away blankets',icon:'üõãÔ∏è'});
  chores.push({tod:'morning',section:'‚ù§Ô∏è Special',label:'Go kiss Momma good morning!',icon:'üíã'});
  chores.push({tod:'afternoon',section:'Everyone',label:'Eat lunch',icon:'ü•™'});
  chores.push({tod:'afternoon',section:'Everyone',label:'Bring lunch plates to sink',icon:'ü´ß'});
  chores.push({tod:'afternoon',section:'Everyone',label:'Put away lunch stuff',icon:'üßπ'});
  chores.push({tod:'evening',section:'Everyone',label:'Eat dinner',icon:'üçΩÔ∏è'});
  chores.push({tod:'evening',section:'Everyone',label:'Bring dinner plates to sink',icon:'ü´ß'});
  chores.push({tod:'evening',section:'Everyone',label:'Eat dessert',icon:'üç®'});
  if (bigIdx !== -1) { var ec = getRotatedChore(bigIdx, rotIdx, EVENING_ROTATION); chores.push({tod:'evening',section:'Clean Up',label:ec.label,icon:ec.icon}); }
  return chores;
}

// URL override: ?day=sunday or ?day=saturday to force a view for testing
function getUrlDayOverride() {
  try { var p = new URLSearchParams(window.location.search).get('day'); if (p) return p.toLowerCase(); } catch(e) {}
  return null;
}
var URL_OVERRIDE = getUrlDayOverride();

function isSunday() {
  if (URL_OVERRIDE) return URL_OVERRIDE === 'sunday';
  return new Date().getDay() === 0;
}
function getDateString(d) { return d.getFullYear()+'-'+(d.getMonth()+1)+'-'+d.getDate(); }
function getTodayKey() {
  var d = new Date();
  if (URL_OVERRIDE === 'sunday') return 'sunday_test';
  if (URL_OVERRIDE === 'saturday') return 'saturday_' + getDateString(d);
  if (d.getDay() === 6) return 'saturday_' + getDateString(d);
  if (d.getDay() === 0) return 'sunday_' + getDateString(d);
  return 'sunday_' + getDateString(d); // fallback
}
function getChoresToday(kidId) {
  return isSunday() ? buildSundayChores(kidId, new Date()) : buildSaturdayChores(kidId);
}

// =============================================
// FIREBASE
// =============================================
var choreState = {};
var unsub = null;
var TODAY_KEY = getTodayKey();

function docRef() { return db.collection('chores').doc(TODAY_KEY); }

function subscribe() {
  if (unsub) unsub();
  setSyncStatus('syncing');
  unsub = docRef().onSnapshot(function(snap) {
    choreState = snap.exists ? (snap.data().state || {}) : {};
    setSyncStatus('synced');
    render();
  }, function() { setSyncStatus('error'); });
}

function save() {
  setSyncStatus('syncing');
  docRef().set({ state: choreState, updatedAt: Date.now() })
    .then(function() { setSyncStatus('synced'); })
    .catch(function() { setSyncStatus('error'); });
}

function setSyncStatus(s) {
  document.getElementById('syncIndicator').className = 'sync-indicator ' + s;
  document.getElementById('syncDot').className = 'sync-dot' + (s === 'syncing' ? ' spinning' : '');
  document.getElementById('syncLabel').textContent = s==='syncing'?'Syncing...':s==='synced'?'Live':'Error';
}

// =============================================
// TOGGLE + SOUND LOGIC
// =============================================
function choreKey(kidId, tod, label) { return kidId+'__'+tod+'__'+label; }
function isChecked(kidId, tod, label) {
  var k = choreKey(kidId, tod, label);
  return !!(choreState[kidId] && choreState[kidId][k] && choreState[kidId][k].done);
}

// Track previous completion states for celebration triggers
var prevKidDone = {};
var prevAllDone = false;

function handleChore(kidId, tod, label, el) {
  el.classList.add('confetti-pop');
  setTimeout(function(){ el.classList.remove('confetti-pop'); }, 250);

  var k = choreKey(kidId, tod, label);
  if (!choreState[kidId]) choreState[kidId] = {};
  var was = choreState[kidId][k] && choreState[kidId][k].done;
  choreState[kidId][k] = { done: !was, ts: Date.now() };

  // Play sound
  if (!was) { soundHighFive(); }
  else       { soundUncheck(); }

  // Check section completion
  if (!was) {
    var chores = getChoresToday(kidId);
    var todChores = chores.filter(function(c){ return c.tod === tod; });
    var allTodDone = todChores.every(function(c){ return isChecked(kidId, c.tod, c.label) || c.label === label; });
    if (allTodDone && todChores.length > 0) {
      setTimeout(function(){ soundSectionComplete(); }, 150);
    }
  }

  render();
  save();
  checkCelebrations(kidId, was);
}

function checkCelebrations(justToggledKid, wasUncheck) {
  if (wasUncheck) return; // only celebrate on check, not uncheck

  var chores = getChoresToday(justToggledKid);
  var kidDone = chores.every(function(c){ return isChecked(justToggledKid, c.tod, c.label); });

  if (kidDone && !prevKidDone[justToggledKid]) {
    prevKidDone[justToggledKid] = true;
    var kid = KIDS.find(function(k){ return k.id === justToggledKid; });
    setTimeout(function(){
      soundCardComplete();
      showCelebration(kid.name + ' finished! üéâ', 'üéâ', 'medium');
    }, 200);
  }

  // Check if all kids done
  var allDone = KIDS.every(function(k){
    var kc = getChoresToday(k.id);
    return kc.every(function(c){ return isChecked(k.id, c.tod, c.label); });
  });

  if (allDone && !prevAllDone) {
    prevAllDone = true;
    setTimeout(function(){
      soundAllDone();
      showCelebration('EVERYONE IS DONE! üèÜ', 'üèÜ', 'big');
    }, 500);
  }
}

// Reset celebration tracking when chores are reset
function resetCelebrationState() {
  prevKidDone = {};
  prevAllDone = false;
}

// =============================================
// RENDER
// =============================================
function render() {
  try {
  var sunday  = isSunday();
  var dayName = sunday ? 'Sunday' : 'Saturday';
  document.getElementById('headerSubtitle').textContent = (sunday?'‚õ™':'üóìÔ∏è') + ' ' + dayName + ' Chores';
  var badge = document.getElementById('dayBadge');
  badge.textContent = dayName;
  badge.className = 'day-badge ' + (sunday ? 'sunday' : 'saturday');

  // Jump links
  document.getElementById('jumpLinks').innerHTML = KIDS.map(function(kid) {
    return '<a class="jump-link jump-' + kid.id + '" href="#card-' + kid.id + '">' +
      '<span id="jav-' + kid.id + '" style="display:inline-block;width:22px;height:22px;vertical-align:middle;margin-right:2px"></span>' +
      kid.name.split(' ')[0] + '</a>';
  }).join('');
  for (var jav = 0; jav < KIDS.length; jav++) {
    setAvatarEl(document.getElementById('jav-' + KIDS[jav].id), KIDS[jav].id);
  }

  // Summary
  var totalDone = 0, totalAll = 0;
  for (var ki = 0; ki < KIDS.length; ki++) {
    var kc = getChoresToday(KIDS[ki].id);
    totalAll += kc.length;
    for (var ci = 0; ci < kc.length; ci++) {
      if (isChecked(KIDS[ki].id, kc[ci].tod, kc[ci].label)) totalDone++;
    }
  }
  var pct = totalAll ? Math.round(totalDone/totalAll*100) : 0;
  document.getElementById('summaryBar').innerHTML =
    '<div class="summary-item">üìã ' + totalDone + ' / ' + totalAll + ' done</div>' +
    '<div class="summary-item">üèÜ ' + pct + '%</div>';

  // Kid cards
  var gridHtml = '';
  for (var k = 0; k < KIDS.length; k++) {
    var kid    = KIDS[k];
    var chores = getChoresToday(kid.id);
    var doneCt = 0;
    for (var c = 0; c < chores.length; c++) {
      if (isChecked(kid.id, chores[c].tod, chores[c].label)) doneCt++;
    }
    var kpct    = chores.length ? Math.round(doneCt/chores.length*100) : 0;
    var allDone = chores.length > 0 && doneCt === chores.length;
    // avatar injected after render via DOM to avoid SVG double-quote escaping issues

    var choreHtml = '<div class="chore-list">';
    for (var ti = 0; ti < TOD_ORDER.length; ti++) {
      var tod = TOD_ORDER[ti];
      var todChores = chores.filter(function(ch){ return ch.tod === tod; });
      if (todChores.length === 0) continue;

      choreHtml += '<div class="tod-divider tod-' + tod + '">' +
        '<span class="tod-divider-label">' + TOD_LABELS[tod] + '</span>' +
        '<div class="tod-divider-line"></div></div>';

      for (var ii = 0; ii < todChores.length; ii++) {
        var ch     = todChores[ii];
        var isDone = isChecked(kid.id, tod, ch.label);
        var ck     = choreKey(kid.id, tod, ch.label);
        var ts     = choreState[kid.id] && choreState[kid.id][ck] && choreState[kid.id][ck].ts;
        var tStr   = ts ? new Date(ts).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}) : '';
        var safe   = ch.label.replace(/\\/g,'\\\\').replace(/'/g,"\\'");
        choreHtml +=
          '<div class="chore-item' + (isDone?' done':'') + '"' +
          ' onclick="handleChore(\'' + kid.id + '\',\'' + tod + '\',\'' + safe + '\',this)">' +
          '<div class="chore-check">' + (isDone?'‚úì':'') + '</div>' +
          '<span class="chore-icon">' + ch.icon + '</span>' +
          '<div style="flex:1"><div class="chore-label">' + ch.label + '</div>' +
          (isDone&&tStr ? '<div class="chore-time">‚úì '+tStr+'</div>' : '') +
          '</div></div>';
      }
    }
    choreHtml += '</div>';

    gridHtml +=
      '<div class="kid-card kid-' + kid.id + '" id="card-' + kid.id + '">' +
        '<div class="kid-header">' +
          '<div class="kid-avatar" id="avatar-' + kid.id + '" onclick="openAvatarModal(\'' + kid.id + '\')"></div>' +
          '<div class="kid-info" style="flex:1">' +
            '<h2>' + kid.name + (allDone ? ' üéâ' : '') + '</h2>' +
            '<div class="kid-age">Age ' + kid.age + '</div>' +
            '<div class="progress-bar-wrap"><div class="progress-bar" style="width:' + kpct + '%"></div></div>' +
          '</div>' +
          '<div class="score-badge">' + doneCt + '/' + chores.length + '</div>' +
        '</div>' +
        choreHtml +
      '</div>';
  }
  document.getElementById('kidsGrid').innerHTML = gridHtml;
  for (var av = 0; av < KIDS.length; av++) {
    setAvatarEl(document.getElementById('avatar-' + KIDS[av].id), KIDS[av].id);
  }
  } catch(e) { document.getElementById('kidsGrid').innerHTML = '<div style="color:red;padding:20px;font-family:monospace">RENDER ERROR: ' + e.message + '<br>' + e.stack + '</div>'; }
}

function resetAll() {
  if (!confirm('Reset all chores for today?')) return;
  choreState = {};
  resetCelebrationState();
  save();
  render();
}

// =============================================
// BOOT
// =============================================
loadAvatars();
loadAvatarsRemote();
subscribe();
</script>
</body>
</html>
